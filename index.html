<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magister - WonderBlox Personeelsbeheer</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

    <style>
        :root {
            --magister-blue: #003d7e;
            --magister-bg: #f4f7f9;
            --magister-sidebar: #ffffff;
            --border-color: #d1d8e0;
            --text-dark: #333333;
            --danger: #e74c3c;
        }

        body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--magister-bg); margin: 0; display: flex; height: 100vh; color: var(--text-dark); }

        /* Login Scherm */
        #login-overlay { position: fixed; inset: 0; background: var(--magister-blue); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .login-box { background: white; padding: 40px; border-radius: 8px; width: 320px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); text-align: center; }
        
        /* Zijbalk */
        nav { width: 240px; background: var(--magister-sidebar); border-right: 1px solid var(--border-color); display: flex; flex-direction: column; }
        .nav-logo { background: var(--magister-blue); color: white; padding: 20px; font-weight: bold; font-size: 1.2rem; }
        nav ul { list-style: none; padding: 0; margin: 0; }
        nav li { padding: 15px 20px; cursor: pointer; border-bottom: 1px solid var(--magister-bg); color: var(--magister-blue); font-weight: 500; }
        nav li:hover { background: #eef2f7; }
        nav li.active { background: #eef2f7; border-left: 4px solid var(--magister-blue); }

        /* Main Content */
        main { flex-grow: 1; padding: 30px; overflow-y: auto; }
        h1 { color: var(--magister-blue); margin-top: 0; }
        .card { background: white; border: 1px solid var(--border-color); border-radius: 4px; padding: 20px; margin-bottom: 20px; }

        /* Zoekbalk Magister */
        .search-container { position: relative; margin-bottom: 20px; }
        .magister-input { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 4px; box-sizing: border-box; font-size: 1rem; }
        .results-list { background: white; border: 1px solid var(--border-color); border-top: none; max-height: 200px; overflow-y: auto; }
        .result-item { padding: 10px 15px; cursor: pointer; border-bottom: 1px solid #f0f0f0; }
        .result-item:hover { background: #f9f9f9; }

        /* Detail Medewerker */
        .profile-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid var(--magister-blue); padding-bottom: 10px; margin-bottom: 20px; }
        .btn { padding: 10px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-absent { background: var(--danger); color: white; margin-right: 5px; margin-bottom: 5px; }
        .btn-blue { background: var(--magister-blue); color: white; }
        
        /* Tabel Stijl */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { background: #f8fafc; text-align: left; padding: 12px; border-bottom: 2px solid var(--border-color); }
        td { padding: 12px; border-bottom: 1px solid #eee; }

        .hidden { display: none; }
        .badge { background: #eee; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; }
    </style>
</head>
<body>

<div id="login-overlay">
    <div class="login-box">
        <h2 style="color: var(--magister-blue)">Magister</h2>
        <p>WonderBlox Inloggen</p>
        <input type="email" id="login-email" class="magister-input" placeholder="E-mailadres" style="margin-bottom: 10px;">
        <input type="password" id="login-pass" class="magister-input" placeholder="Wachtwoord" style="margin-bottom: 20px;">
        <button onclick="handleLogin()" class="btn btn-blue" style="width: 100%;">Inloggen</button>
    </div>
</div>

<nav id="sidebar" class="hidden">
    <div class="nav-logo">WonderBlox</div>
    <ul>
        <li onclick="showSection('medewerkers')" id="menu-medewerkers" class="active">Personen</li>
        <li onclick="showSection('beheer')" id="menu-beheer">Beheer</li>
        <li onclick="logout()" style="margin-top: auto; color: var(--danger);">Uitloggen</li>
    </ul>
</nav>

<main id="content" class="hidden">
    <section id="sec-medewerkers">
        <h1>Medewerkers zoeken</h1>
        <div class="search-container">
            <input type="text" id="searchInput" class="magister-input" placeholder="Zoek medewerker (bijv. Jan)..." onkeyup="searchStaff()">
            <div id="resultsList" class="results-list hidden"></div>
        </div>

        <div id="staffDetail" class="card hidden">
            <div class="profile-header">
                <div>
                    <h2 id="det-naam" style="margin:0;">Naam</h2>
                    <span id="det-rang" class="badge">Rang</span>
                </div>
                <div style="text-align: right;">
                    <small>Begeleider:</small><br>
                    <strong id="det-begeleider">-</strong>
                </div>
            </div>

            <h3>Afwezigheid registreren</h3>
            <div class="absent-actions">
                <button class="btn btn-absent" onclick="logAbsence('Absent Voor vergadering')">Absent Voor vergadering</button>
                <button class="btn btn-absent" onclick="logAbsence('Absent')">Absent</button>
                <button class="btn btn-absent" onclick="logAbsence('Absent Tijdens Werkuur')">Absent Tijdens Werkuur</button>
                <button class="btn btn-absent" onclick="logAbsence('Absent zonder afmelden')">Absent zonder afmelden</button>
                <button class="btn btn-blue" onclick="customAbsence()">+ Andere reden</button>
                <button class="btn" onclick="resetStatus()" style="background:#2ecc71; color:white;">Aanwezig melden</button>
            </div>

            <h3>Afwezigheidshistorie</h3>
            <table>
                <thead>
                    <tr><th>Datum & Tijd</th><th>Status / Reden</th></tr>
                </thead>
                <tbody id="det-logs"></tbody>
            </table>
        </div>
    </section>

    <section id="sec-beheer" class="hidden">
        <h1>Beheer & Instellingen</h1>
        <div class="card">
            <h3>Nieuwe medewerker aanmaken</h3>
            <label>Volledige naam:</label>
            <input type="text" id="add-naam" class="magister-input" placeholder="Bijv. Piet Jansen">
            <label>Rang:</label>
            <input type="text" id="add-rang" class="magister-input" placeholder="Bijv. Senior Begeleider">
            <label>Begeleider:</label>
            <input type="text" id="add-begeleider" class="magister-input" placeholder="Naam van de begeleider">
            <button onclick="addNewStaff()" class="btn btn-blue" style="margin-top:10px;">Toevoegen aan Magister</button>
        </div>
    </section>
</main>

<script>
    // --- FIREBASE CONFIG ---
    const firebaseConfig = {
        apiKey: "AIzaSyAZ2N7lP-W9S8KeOE8Y0iTJyCdQSS-WtOw",
        authDomain: "wonderblox-1f980.firebaseapp.com",
        projectId: "wonderblox-1f980",
        storageBucket: "wonderblox-1f980.firebasestorage.app",
        messagingSenderId: "346721755105",
        appId: "1:346721755105:web:09a70cb4fd2ab5c26c7ca0",
        measurementId: "G-58NB24LJQY"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    let currentStaffId = null;

    // --- AUTH ---
    auth.onAuthStateChanged(user => {
        if (user) {
            document.getElementById('login-overlay').classList.add('hidden');
            document.getElementById('sidebar').classList.remove('hidden');
            document.getElementById('content').classList.remove('hidden');
        } else {
            document.getElementById('login-overlay').classList.remove('hidden');
            document.getElementById('sidebar').classList.add('hidden');
            document.getElementById('content').classList.add('hidden');
        }
    });

    async function handleLogin() {
        const email = document.getElementById('login-email').value;
        const pass = document.getElementById('login-pass').value;
        try {
            await auth.signInWithEmailAndPassword(email, pass);
        } catch (e) { alert("Inloggen mislukt: " + e.message); }
    }

    function logout() { auth.signOut(); }

    // --- FUNCTIES ---
    async function addNewStaff() {
        const naam = document.getElementById('add-naam').value;
        const rang = document.getElementById('add-rang').value;
        const begeleider = document.getElementById('add-begeleider').value;

        if(!naam || !rang) return alert("Vul alle velden in");

        await db.collection("staff").add({
            naam, rang, begeleider,
            logs: []
        });
        alert("Medewerker succesvol toegevoegd aan WonderBlox!");
        document.getElementById('add-naam').value = '';
        showSection('medewerkers');
    }

    async function searchStaff() {
        const q = document.getElementById('searchInput').value.toLowerCase();
        const resultsDiv = document.getElementById('resultsList');
        
        if(q.length < 1) {
            resultsDiv.classList.add('hidden');
            return;
        }

        const snapshot = await db.collection("staff").get();
        let html = "";
        snapshot.forEach(doc => {
            const data = doc.data();
            if(data.naam.toLowerCase().includes(q)) {
                html += `<div class="result-item" onclick="viewStaff('${doc.id}')">${data.naam} <small>(${data.rang})</small></div>`;
            }
        });
        
        resultsDiv.innerHTML = html;
        resultsDiv.classList.remove('hidden');
    }

    async function viewStaff(id) {
        currentStaffId = id;
        document.getElementById('resultsList').classList.add('hidden');
        document.getElementById('searchInput').value = "";
        
        const doc = await db.collection("staff").doc(id).get();
        const data = doc.data();

        document.getElementById('det-naam').innerText = data.naam;
        document.getElementById('det-rang').innerText = data.rang;
        document.getElementById('det-begeleider').innerText = data.begeleider || "Geen";
        
        const logHtml = (data.logs || []).reverse().map(log => `
            <tr>
                <td>${log.datum}</td>
                <td><strong>${log.type}</strong></td>
            </tr>
        `).join('');
        
        document.getElementById('det-logs').innerHTML = logHtml || "<tr><td colspan='2'>Geen afwezigheid bekend.</td></tr>";
        document.getElementById('staffDetail').classList.remove('hidden');
    }

    async function logAbsence(type) {
        if(!currentStaffId) return;
        const timestamp = new Date().toLocaleString('nl-NL');
        
        await db.collection("staff").doc(currentStaffId).update({
            logs: firebase.firestore.FieldValue.arrayUnion({ datum: timestamp, type: type })
        });
        
        viewStaff(currentStaffId);
        alert("Status opgeslagen: " + type);
    }

    function customAbsence() {
        const reden = prompt("Voer de reden van afwezigheid in (bijv. Absent Geoorloofd):");
        if(reden) logAbsence(reden);
    }

    async function resetStatus() {
        if(confirm("Weet je zeker dat je deze persoon weer op aanwezig wilt zetten?")) {
            logAbsence("Aanwezig gemeld (Einde absentie)");
        }
    }

    function showSection(id) {
        document.getElementById('sec-medewerkers').classList.add('hidden');
        document.getElementById('sec-beheer').classList.add('hidden');
        document.getElementById('menu-medewerkers').classList.remove('active');
        document.getElementById('menu-beheer').classList.remove('active');
        
        document.getElementById('sec-' + id).classList.remove('hidden');
        document.getElementById('menu-' + id).classList.add('active');
    }
</script>

</body>
</html>
